<!DOCTYPE html>
<html lang="en">

<head>
    <base href="/">
    <title>Markdown Syntax Guide - Tanka Docs Generator - WIP</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Noto Color Emoji font for cross-platform emoji support -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    
    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

    <style>
        :root {
            --bs-body-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
            --bs-link-color-rgb: 8, 87, 168;
            --bs-link-hover-color-rgb: 6, 68, 130;
        }

        body {
            font-family: var(--bs-body-font-family);
        }

        .sidebar {
            position: sticky;
            top: 56px; /* Height of navbar */
            height: calc(100vh - 56px);
            overflow-y: auto;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding-top: 1rem;
        }

        .toc-sidebar {
            position: sticky;
            top: 56px; /* Height of navbar */
            height: calc(100vh - 56px);
            overflow-y: auto;
            padding-top: 1rem;
        }

        /* Offcanvas customization */
        .offcanvas-md {
            --bs-offcanvas-transition: transform .15s ease-in-out; /* Faster animation */
        }
        
        /* Remove extra whitespace above content on mobile */
        @media (max-width: 767.98px) {
            main.content {
                padding-top: 1rem;
            }
            
            /* Hide mobile control buttons when offcanvas is shown */
            .offcanvas-md.show ~ .content .d-lg-none {
                display: none !important;
            }
        }

        .toc-toggle {
            display: none;
        }

        @media (max-width: 991.98px) {
            .toc-toggle {
                display: inline-block;
            }
        }

        .sidebar .nav-link {
            font-size: 0.9rem;
            color: #495057;
        }

        .sidebar .nav-link.active, .sidebar .nav-link:hover {
            color: rgb(var(--bs-link-color-rgb));
            font-weight: 500;
        }

        /* Ensure emojis render properly in navigation */
        .sidebar .nav-link {
            font-feature-settings: "liga" on, "clig" on;
            text-rendering: optimizeLegibility;
        }

        /* Ensure emojis have proper font fallback */
        .sidebar .nav-link {
            font-family: var(--bs-body-font-family);
        }
        
        .toc-sidebar .nav-link {
            font-size: 0.8rem;
            color: #6c757d;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }

        .toc-sidebar .nav-link:hover {
            color: #212529;
        }

        .toc-sidebar .nav-link.active {
            font-weight: 600;
            color: #212529; /* Darker text for readability */
            border-left: 2px solid rgb(var(--bs-link-color-rgb));
        }

        blockquote {
            font-size: 1rem;
            border-left: 4px solid #adb5bd;
            padding-left: 1rem;
            color: #6c757d;
        }

        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .content h2, .content h3 {
            scroll-margin-top: 80px;
        }

        /* Adjust code block styling to match highlight.js theme */
        pre code.hljs {
            border-radius: 0.3rem;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Tanka Docs Generator - WIP</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="HEAD/index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="HEAD/01-getting-started/getting-started.html">Getting Started</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="HEAD/02-project-structure/index.html">Project Structure</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="HEAD/03-writing-content/index.html">Writing Content</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="HEAD/04-advanced/index.html">Advanced Features</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="HEAD/05-customization/index.html">UI Customization</a>
                        </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/pekkah/tanka-docs-gen" target="_blank" rel="noopener">GitHub</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            HEAD
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                <li><a class="dropdown-item" href="/HEAD">HEAD</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar offcanvas-md offcanvas-start" tabindex="-1">
                <div class="offcanvas-header d-md-none">
                    <h5 class="offcanvas-title">Navigation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebar" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=HEAD/03-writing-content/markdown.html>Markdown Syntax</a>
    </div>
</li>    </nav>
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=HEAD/03-writing-content/include.html>Include Directives</a>
    </div>
</li>    </nav>
    <nav class="nav flex-column">
<li class="nav-item">
    <div class="d-flex justify-content-between align-items-center">
        <a class="nav-link" href=HEAD/03-writing-content/xref.html>Cross-References (xref)</a>
    </div>
</li>    </nav>
                </div>
            </nav>
            <main class="col-md-6 ms-sm-auto col-lg-7 px-md-4 py-3 content d-flex flex-column">
                <!-- Mobile navigation controls -->
                <div class="d-lg-none mb-3">
                    <button class="btn btn-outline-primary btn-sm me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar">
                        <svg width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        <span class="ms-1">Menu</span>
                    </button>
                </div>
                <!-- Mobile TOC toggle button -->
                <div class="d-lg-none mb-3">
                    <button class="btn btn-outline-secondary btn-sm toc-toggle mb-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#toc" aria-controls="toc">
                        <svg width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        <span class="ms-1">On this page</span>
                    </button>
                </div>
                <h1 id="markdown-syntax-guide">Markdown Syntax Guide</h1>
<p>Tanka Docs uses <a href="https://github.com/xoofx/markdig">Markdig</a> as its Markdown processor, which provides standard Markdown syntax plus many useful extensions. This guide covers the syntax you can use in your documentation.</p>
<h2 id="standard-markdown">Standard Markdown</h2>
<h3 id="headers">Headers</h3>
<pre><code class="language-markdown"># H1 Header
## H2 Header  
### H3 Header
#### H4 Header
##### H5 Header
###### H6 Header
</code></pre>
<h3 id="text-formatting">Text Formatting</h3>
<pre><code class="language-markdown">**Bold text**
*Italic text*
***Bold and italic***
~~Strikethrough~~
`Inline code`
</code></pre>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Bold text</strong></li>
<li><em>Italic text</em></li>
<li><em><strong>Bold and italic</strong></em></li>
<li><del>Strikethrough</del></li>
<li><code>Inline code</code></li>
</ul>
<h3 id="lists">Lists</h3>
<p><strong>Unordered Lists:</strong></p>
<pre><code class="language-markdown">- Item 1
- Item 2
  - Nested item
  - Another nested item
- Item 3
</code></pre>
<p><strong>Ordered Lists:</strong></p>
<pre><code class="language-markdown">1. First item
2. Second item
   1. Nested item
   2. Another nested item
3. Third item
</code></pre>
<h3 id="links-and-images">Links and Images</h3>
<pre><code class="language-markdown">[Link text](https://example.com)
[Link with title](https://example.com &quot;Link title&quot;)
![Image alt text](path/to/image.png)
![Image with title](path/to/image.png &quot;Image title&quot;)
</code></pre>
<h3 id="code-blocks">Code Blocks</h3>
<p><strong>Fenced code blocks:</strong></p>
<pre><code class="language-markdown">```javascript
function hello() {
    console.log(&quot;Hello, world!&quot;);
}
```
</code></pre>
<p><strong>With line numbers:</strong></p>
<pre><code class="language-markdown">```csharp {.line-numbers}
public class Example
{
    public void Method() { }
}
```
</code></pre>
<h2 id="tanka-docs-extensions">Tanka Docs Extensions</h2>
<h3 id="include-directives">Include Directives</h3>
<p>Include content from other files using the <code>\#include::</code> syntax:</p>
<pre><code class="language-markdown">\#include::xref://src:Program.cs
\#include::xref://src:Program.cs?s=MyNamespace.MyClass.MyMethod
\#include::xref://_partials:common-notice.md
</code></pre>
<p>See the <a href="HEAD/03-writing-content/include.html">Include Directives</a> guide for detailed information.</p>
<h3 id="cross-references">Cross-References</h3>
<p>Link to other pages using the <code>xref://</code> syntax:</p>
<pre><code class="language-markdown">[Link to same section](xref://other-page.md)
[Link to different section](xref://section-id:page.md)
[Link to specific version](xref://section-id@1.0.0:page.md)
</code></pre>
<p>See the <a href="HEAD/03-writing-content/xref.html">Cross-References</a> guide for detailed information.</p>
<h2 id="markdig-extensions">Markdig Extensions</h2>
<h3 id="tables">Tables</h3>
<pre><code class="language-markdown">| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Data 1   | Data 2   | Data 3   |
| Data 4   | Data 5   | Data 6   |
</code></pre>
<p><strong>With alignment:</strong></p>
<pre><code class="language-markdown">| Left | Center | Right |
|:-----|:------:|------:|
| L1   | C1     | R1    |
| L2   | C2     | R2    |
</code></pre>
<h3 id="task-lists">Task Lists</h3>
<pre><code class="language-markdown">- [x] Completed task
- [ ] Incomplete task
- [x] Another completed task
</code></pre>
<p><strong>Result:</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input disabled="disabled" type="checkbox" checked="checked" /> Completed task</li>
<li class="task-list-item"><input disabled="disabled" type="checkbox" /> Incomplete task</li>
<li class="task-list-item"><input disabled="disabled" type="checkbox" checked="checked" /> Another completed task</li>
</ul>
<h3 id="admonitionscallouts">Admonitions/Callouts</h3>
<pre><code class="language-markdown">!!! note &quot;Optional Title&quot;
    This is a note admonition.

!!! warning
    This is a warning without a custom title.

!!! tip &quot;Pro Tip&quot;
    This is a tip with a custom title.
</code></pre>
<p><strong>Available types:</strong></p>
<ul>
<li><code>note</code> - General information</li>
<li><code>tip</code> - Helpful tips</li>
<li><code>warning</code> - Important warnings</li>
<li><code>danger</code> - Critical warnings</li>
<li><code>info</code> - Informational content</li>
</ul>
<h3 id="definition-lists">Definition Lists</h3>
<pre><code class="language-markdown">Term 1
:   Definition 1

Term 2  
:   Definition 2a
:   Definition 2b
</code></pre>
<h3 id="abbreviations">Abbreviations</h3>
<pre><code class="language-markdown">The HTML specification is maintained by the W3C.

*[HTML]: HyperText Markup Language
*[W3C]: World Wide Web Consortium
</code></pre>
<h3 id="footnotes">Footnotes</h3>
<pre><code class="language-markdown">Here's a sentence with a footnote[^1].

[^1]: This is the footnote content.
</code></pre>
<h3 id="math-latex">Math (LaTeX)</h3>
<p><strong>Inline math:</strong></p>
<pre><code class="language-markdown">The formula is $E = mc^2$.
</code></pre>
<p><strong>Block math:</strong></p>
<pre><code class="language-markdown">$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$
</code></pre>
<h3 id="emojis">Emojis</h3>
<pre><code class="language-markdown">:smile: :heart: :thumbsup: :warning:
</code></pre>
<p>You can use GitHub-style emoji codes in your text.</p>
<h3 id="highlighting">Highlighting</h3>
<pre><code class="language-markdown">==highlighted text==
</code></pre>
<h3 id="keyboard-keys">Keyboard Keys</h3>
<pre><code class="language-markdown">Press ++ctrl+alt+del++ to restart.
</code></pre>
<h3 id="smart-typography">Smart Typography</h3>
<p>Automatic conversions:</p>
<ul>
<li><code>--</code> becomes –</li>
<li><code>---</code> becomes —</li>
<li><code>(c)</code> becomes ©</li>
<li><code>(tm)</code> becomes ™</li>
<li><code>&quot;quotes&quot;</code> become &quot;smart quotes&quot;</li>
</ul>
<h2 id="front-matter">Front Matter</h2>
<p>Add YAML front matter to your pages for metadata:</p>
<pre><code class="language-markdown">---
title: &quot;Page Title&quot;
description: &quot;Page description for SEO&quot;
author: &quot;Author Name&quot;
date: &quot;2024-01-15&quot;
tags: [&quot;tag1&quot;, &quot;tag2&quot;]
---

# Your content starts here
</code></pre>
<h2 id="code-syntax-highlighting">Code Syntax Highlighting</h2>
<p>Tanka Docs supports syntax highlighting for many languages:</p>
<h3 id="c-examples">C# Examples</h3>
<pre><code class="language-markdown">```csharp
public class Example
{
    public string Name { get; set; }
    
    public void DoSomething()
    {
        Console.WriteLine($&quot;Hello, {Name}!&quot;);
    }
}
```
</code></pre>
<h3 id="javascript-examples">JavaScript Examples</h3>
<pre><code class="language-markdown">```javascript
function fetchData(url) {
    return fetch(url)
        .then(response =&gt; response.json())
        .catch(error =&gt; console.error('Error:', error));
}
```
</code></pre>
<h3 id="yaml-examples">YAML Examples</h3>
<pre><code class="language-markdown">```yaml
title: &quot;My Site&quot;
description: &quot;A documentation site&quot;
sources:
  - name: &quot;local&quot;
    type: &quot;local&quot;
    path: &quot;.&quot;
```
</code></pre>
<h3 id="json-examples">JSON Examples</h3>
<pre><code class="language-markdown">```json
{
  &quot;name&quot;: &quot;my-project&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;dependencies&quot;: {
    &quot;example&quot;: &quot;^1.0.0&quot;
  }
}
```
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="document-structure">Document Structure</h3>
<ol>
<li><strong>Use clear headings</strong> - Structure your content hierarchically</li>
<li><strong>Add table of contents</strong> - For longer documents</li>
<li><strong>Use consistent formatting</strong> - Be consistent with code blocks, links, etc.</li>
<li><strong>Include examples</strong> - Show don't just tell</li>
</ol>
<h3 id="code-documentation">Code Documentation</h3>
<ol>
<li><strong>Syntax highlighting</strong> - Always specify language for code blocks</li>
<li><strong>Include context</strong> - Explain what the code does</li>
<li><strong>Use includes</strong> - Reference actual source files when possible</li>
<li><strong>Line numbers</strong> - Use for longer code examples</li>
</ol>
<h3 id="links-and-references">Links and References</h3>
<ol>
<li><strong>Use xref links</strong> - For internal documentation links</li>
<li><strong>Descriptive link text</strong> - Avoid &quot;click here&quot; or generic text</li>
<li><strong>Check broken links</strong> - Validate links during build</li>
</ol>
<h3 id="accessibility">Accessibility</h3>
<ol>
<li><strong>Alt text for images</strong> - Always provide meaningful alt text</li>
<li><strong>Clear link text</strong> - Links should be descriptive</li>
<li><strong>Proper heading hierarchy</strong> - Don't skip heading levels</li>
<li><strong>Table headers</strong> - Use proper table markup</li>
</ol>
<h2 id="markdown-validation">Markdown Validation</h2>
<p>To ensure your Markdown is valid:</p>
<ol>
<li><strong>Preview locally</strong> - Use your editor's preview feature</li>
<li><strong>Build and check</strong> - Use <code>tanka-docs build</code> to catch errors</li>
<li><strong>Use debug mode</strong> - Add <code>--debug</code> flag for detailed error information</li>
<li><strong>Validate syntax</strong> - Use online Markdown validators</li>
</ol>
<h2 id="common-pitfalls">Common Pitfalls</h2>
<h3 id="escaping-special-characters">Escaping Special Characters</h3>
<p>When you need to show literal Markdown syntax:</p>
<pre><code class="language-markdown">To show a literal asterisk: \*not italic\*
To show a literal backtick: \`not code\`
To show a literal hash: \#not a header
</code></pre>
<h3 id="mixed-content-types">Mixed Content Types</h3>
<p>Be careful when mixing HTML with Markdown:</p>
<pre><code class="language-markdown">&lt;!-- This works --&gt;
&lt;div class=&quot;custom-class&quot;&gt;
**This Markdown** will be processed.
&lt;/div&gt;

&lt;!-- This doesn't work as expected --&gt;
&lt;div&gt;**This might not be processed**&lt;/div&gt;
</code></pre>
<h3 id="code-block-languages">Code Block Languages</h3>
<p>Use correct language identifiers:</p>
<pre><code class="language-markdown">&lt;!-- Good --&gt;
```csharp
// C# code
</code></pre>
<!-- Bad -->
<pre><code class="language-c#">// Wrong identifier
</code></pre>
<pre><code>
## Editor Support

Most modern editors support Markdown with extensions:

- **VS Code**: Markdown Preview Enhanced, Markdig extensions
- **JetBrains IDEs**: Built-in Markdown support
- **Typora**: WYSIWYG Markdown editor
- **Mark Text**: Real-time preview editor

Configure your editor to use Markdig-compatible extensions for the best preview experience. 
</code></pre>

            </main>
            <!-- Single responsive TOC -->
            <nav id="toc" class="col-md-3 col-lg-3 d-none d-lg-block toc-sidebar offcanvas-md offcanvas-end" tabindex="-1">
                <div class="offcanvas-header d-md-none">
                    <h5 class="offcanvas-title">On this page</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#toc" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <strong class="d-block h6 my-2 pb-2 border-bottom toc-title d-none d-md-block">On this page</strong>
                    <nav class="nav flex-column"></nav>
                </div>
            </nav>
        </div>
    </div>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <script>
        (function() {

            // Left sidebar active link
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                const baseHref = document.baseURI;
                const currentPageHref = window.location.href.split('#')[0]; // Ignore hash
                let currentPagePath = currentPageHref.substring(baseHref.length);

                if (currentPagePath.endsWith('/')) {
                    currentPagePath = currentPagePath.slice(0, -1);
                }

                const navLinks = sidebar.querySelectorAll('a.nav-link');
                navLinks.forEach(link => {
                    const linkHref = link.getAttribute('href');
                    if (linkHref && (linkHref === currentPagePath || linkHref === currentPagePath + '/index.html')) {
                        link.classList.add('active');

                        let parentCollapse = link.closest('.collapse');
                        while(parentCollapse) {
                            parentCollapse.classList.add('show');
                            const trigger = document.querySelector(`a[data-bs-toggle="collapse"][href="#${parentCollapse.id}"]`);
                            if (trigger) {
                                trigger.setAttribute('aria-expanded', 'true');
                                trigger.classList.remove('collapsed');
                            }
                            parentCollapse = parentCollapse.parentElement.closest('.collapse');
                        }
                    }
                });
            }

            // "On this page" TOC script - single responsive TOC
            const toc = document.getElementById('toc');
            const tocToggle = document.getElementById('toc-toggle');
            
            // Constants
            const SCROLL_OFFSET = 100;
            const SCROLL_THROTTLE_MS = 25; // Optimized from 10ms
            const SCROLL_NAVIGATION_TIMEOUT_MS = 200;
            const MOBILE_BREAKPOINT = 992;
            
            if (toc) {
                const mainContent = document.querySelector('.content');
                if (!mainContent) return;
                
                const headings = mainContent.querySelectorAll('h2, h3');
                const tocNav = toc.querySelector('.offcanvas-body .nav');
                
                if (!tocNav) return;
                
                if (headings.length > 0) {
                    let isScrolling = false;
                    
                    // Create TOC links
                    headings.forEach((heading, index) => {
                        const id = 'heading-' + index;
                        if (!heading.getAttribute('id')) {
                            heading.setAttribute('id', id);
                        }

                        const link = document.createElement('a');
                        link.classList.add('nav-link');
                        if (heading.tagName === 'H3') {
                            link.classList.add('ms-3'); // Indent H3
                        }
                        
                        const href = '#' + id;
                        link.setAttribute('href', href);
                        link.textContent = heading.textContent;

                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            
                            // Temporarily disable scroll tracking during navigation
                            isScrolling = true;
                            
                            // Remove active class from all TOC links
                            tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                            
                            // Add active class to clicked link
                            link.classList.add('active');
                            
                            // On mobile, collapse the TOC after clicking a link
                            if (window.innerWidth < MOBILE_BREAKPOINT && toc) {
                                toc.classList.add('collapsed');
                                if (tocToggle) {
                                    updateToggleButton(true);
                                }
                            }
                            
                            // Navigate to the hash
                            window.location.hash = href;
                            
                            // Re-enable scroll tracking after navigation completes
                            let scrollTimeout;
                            const handleScroll = () => {
                                clearTimeout(scrollTimeout);
                                scrollTimeout = setTimeout(() => {
                                    window.removeEventListener('scroll', handleScroll);
                                    isScrolling = false;
                                }, SCROLL_NAVIGATION_TIMEOUT_MS);
                            };
                            
                            window.addEventListener('scroll', handleScroll);
                            
                            // Fallback: re-enable after 1 second
                            setTimeout(() => {
                                window.removeEventListener('scroll', handleScroll);
                                isScrolling = false;
                            }, 1000);
                        });
                        
                        tocNav.appendChild(link);
                    });

                    // Update toggle button appearance
                    const updateToggleButton = (isCollapsed) => {
                        if (!tocToggle) return;
                        
                        if (isCollapsed) {
                            tocToggle.innerHTML = `<svg width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                            </svg><span class="ms-1">On this page</span>`;
                        } else {
                            tocToggle.innerHTML = `<svg width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                            </svg><span class="ms-1">Hide</span>`;
                        }
                    };

                    // Set initial active state based on current scroll position or hash
                    const setInitialActiveState = () => {
                        const hash = window.location.hash;
                        if (hash && tocNav) {
                            const targetLink = tocNav.querySelector(`a[href="${hash}"]`);
                            if (targetLink) {
                                tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                                targetLink.classList.add('active');
                                return;
                            }
                        }
                        
                        // Find the currently visible heading
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        let activeHeading = null;
                        
                        for (let i = 0; i < headings.length; i++) {
                            const heading = headings[i];
                            const rect = heading.getBoundingClientRect();
                            const headingTop = rect.top + scrollTop;
                            
                            if (headingTop <= scrollTop + SCROLL_OFFSET) {
                                activeHeading = heading;
                            } else {
                                break;
                            }
                        }
                        
                        if (activeHeading && tocNav) {
                            const activeId = activeHeading.getAttribute('id');
                            const activeLink = tocNav.querySelector(`a[href="#${activeId}"]`);
                            if (activeLink) {
                                tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                                activeLink.classList.add('active');
                            }
                        } else if (tocNav) {
                            // If no heading is visible, activate the first one
                            const firstLink = tocNav.querySelector('.nav-link');
                            if (firstLink) {
                                firstLink.classList.add('active');
                            }
                        }
                    };

                    // Set initial active state
                    setInitialActiveState();

                    // Optimized scroll tracking
                    const updateActiveOnScroll = () => {
                        if (isScrolling || !tocNav) return;
                        
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        let activeHeading = null;
                        
                        for (let i = 0; i < headings.length; i++) {
                            const heading = headings[i];
                            const rect = heading.getBoundingClientRect();
                            const headingTop = rect.top + scrollTop;
                            
                            if (headingTop <= scrollTop + SCROLL_OFFSET) {
                                activeHeading = heading;
                            } else {
                                break;
                            }
                        }
                        
                        const currentActiveLink = tocNav.querySelector('.nav-link.active');
                        let newActiveLink = null;
                        
                        if (activeHeading) {
                            const activeId = activeHeading.getAttribute('id');
                            newActiveLink = tocNav.querySelector(`a[href="#${activeId}"]`);
                        } else {
                            newActiveLink = tocNav.querySelector('.nav-link');
                        }
                        
                        if (newActiveLink && newActiveLink !== currentActiveLink) {
                            tocNav.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                            newActiveLink.classList.add('active');
                        }
                    };
                    
                    // Throttled scroll listener
                    let scrollTimeout;
                    window.addEventListener('scroll', () => {
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(updateActiveOnScroll, SCROLL_THROTTLE_MS);
                    });

                    // Mobile TOC toggle functionality
                    if (tocToggle) {
                        tocToggle.addEventListener('click', () => {
                            const isCollapsed = toc.classList.contains('collapsed');
                            if (isCollapsed) {
                                toc.classList.remove('collapsed');
                                updateToggleButton(false);
                            } else {
                                toc.classList.add('collapsed');
                                updateToggleButton(true);
                            }
                        });
                    }
                } else {
                    // Hide TOC if no headings
                    toc.style.display = 'none';
                    if (tocToggle) tocToggle.style.display = 'none';
                }
            }

            // Auto-close offcanvas menus when navigation links are clicked on mobile
            // Reuse already declared sidebar and toc variables
            
            // Function to close offcanvas
            const closeOffcanvas = (element) => {
                const bsOffcanvas = bootstrap.Offcanvas.getInstance(element);
                if (bsOffcanvas) {
                    bsOffcanvas.hide();
                }
            };
            
            // Auto-close sidebar when navigation links are clicked
            if (sidebar) {
                const sidebarLinks = sidebar.querySelectorAll('a.nav-link');
                sidebarLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        // Only auto-close on mobile
                        if (window.innerWidth < MOBILE_BREAKPOINT) {
                            closeOffcanvas(sidebar);
                        }
                    });
                });
            }
            
            // Auto-close TOC when TOC links are clicked
            if (toc) {
                const tocNav = toc.querySelector('.offcanvas-body .nav');
                if (tocNav) {
                    tocNav.addEventListener('click', (e) => {
                        if (e.target.tagName === 'A' && window.innerWidth < MOBILE_BREAKPOINT) {
                            closeOffcanvas(toc);
                        }
                    });
                }
            }

            if (window.location.hostname !== 'localhost') {
                return;
            }
            // Live reload script
            const port = window.location.port || (window.location.protocol === 'https:' ? '443' : '80');
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const socketUrl = `${protocol}//${window.location.hostname}:${port}/ws`;
            let socket;

            function connect() {
                socket = new WebSocket(socketUrl);
                socket.addEventListener('open', () => { console.log('Live reload connected.'); });
                socket.addEventListener('message', (event) => {
                    if (event.data === 'reload') {
                        console.log('Reloading page...');
                        window.location.reload();
                    }
                });
                socket.addEventListener('close', () => {
                    console.log('Live reload disconnected. Trying to reconnect in 2 seconds...');
                    setTimeout(connect, 2000);
                });
                socket.addEventListener('error', (err) => {
                    console.error('Live reload error:', err);
                    socket.close();
                });
            }
            connect();
        })();
    </script>
</body>
</html>